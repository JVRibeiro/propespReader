scanner={};
var x="propesp",KEY="propespti2013",logIsEnabled,snapTimeout,toastTimeout,cameraGlobal,actualLiArr,actualScrollEl,actualContentEl,isCameraTabActive=!0,saved_li_arr=[],rejected_li_arr=[],syncArr=[],qrScan={data:[],rejected:[],LOADING:document.querySelector(".loading"),sortNumber:function(a,b){return a-b},initHtmlElement:function(a){return document.getElementById(a)},initVideoObjectOptions:function(a){scanner={};return{video:qrScan.initHtmlElement(a),continuous:!0,mirror:!1,captureImage:!1,backgroundScan:!1,
refractoryPeriod:4E3,scanPeriod:5}},initAvaliableCameras:function(a){Instascan.Camera.getCameras().then(function(b){a()})},initCamera:function(a){scanner.stop();Instascan.Camera.getCameras().then(function(a){if(0<a.length){var b=a[0];$.each(a,function(a,c){if(-1!==c.name.indexOf("back"))return b=c,!1});scanner.start(b);cameraGlobal=b}else alert("Nenhuma camera encontrada.")})},scanStart:function(a){scanner.addListener("scan",function(b){a(b)})},saveScannedData:function(a){var b;console.log("QR Code content: "+
a);console.log("Analysing...");console.log("Executing pretest...");null===a.match(/(\n|\s|\{|\()/g)&&(console.log("QR Code is maybe valid. Checking encoding..."),a=CryptoJS.AES.decrypt(a,KEY),a=full_dec=a.toString(CryptoJS.enc.Utf8),(b=null!==a.match(/^\{(.*)\}/g)?!0:!1)?(console.log("QR Code is encoded! Checking authenticity..."),b=null!==a.match(/^\x7b\"\x70\x72\x6f\x70\x65\x73\x70\"\:\x7b(.*)\x7d\x7d/g)?!0:!1):(console.log("QR Code is not encoded!"),console.log("QR Code is invalid!"),b=!1));b?
(console.log("QR Code is valid!"),console.log("QR data: "+a),qrScan.animate._snap(),qrScan.animate._success(),qrScan.data.push(JSON.parse(a)),a=JSON.stringify(qrScan.data),console.log("Dados salvos em RAM: "+a),a=CryptoJS.AES.encrypt(a,KEY),console.log("Dados codificados: "+a),localStorage.setItem("data",a),qrScan.animate._showToast("Dados salvos!",1100),qrScan.updateHTMLArray("data"),qrScan.updateCluster(saved_li_arr)):(console.log("QR Code is invalid!"),qrScan.animate._snap(),qrScan.animate._error(),
null!==a.match(/^\{(.*)\}/g)?qrScan.rejected.push(JSON.parse(a)):qrScan.rejected.push(a),console.log("Dados rejeitados: "+a),a=JSON.stringify(qrScan.rejected),console.log("Dados rejeitados salvos em RAM: "+a),a=CryptoJS.AES.encrypt(a,KEY),console.log("Dados rejeitados codificados: "+a),localStorage.setItem("rejected",a),qrScan.animate._showToast("QR Code inv\u00e1lido!",1100),qrScan.updateHTMLArray("rejected"),qrScan.updateCluster(rejected_li_arr))},loadFromLS:function(a){if("data"===a||void 0===
a){var b=CryptoJS.AES.decrypt(localStorage.getItem("data"),KEY).toString(CryptoJS.enc.Utf8);qrScan.data=null===localStorage.getItem("data")?qrScan.data:JSON.parse(b)}if("rejected"===a||void 0===a)a=CryptoJS.AES.decrypt(localStorage.getItem("rejected"),KEY).toString(CryptoJS.enc.Utf8),qrScan.rejected=null===localStorage.getItem("rejected")?qrScan.rejected:JSON.parse(a)},updateHTMLArray:function(a){if("data"===a||void 0===a){saved_li_arr=[];for(var b=qrScan.data.length,c=0;c<b;c++)saved_li_arr.push('<li class="collection-item avatar" data-id="'+
qrScan.data[c][x].id+'"><i class="material-icons circle">cloud_off</i><span class="title">'+qrScan.data[c][x].nome+'</span><p class="grey-text">N\u00e3o sincronizado<br></li>')}if("rejected"===a||void 0===a)for(rejected_li_arr=[],a=qrScan.rejected.length,b=0;b<a;b++)rejected_li_arr.push('<li class="collection-item"><span class="title">'+JSON.stringify(qrScan.rejected[b])+"</span></li>")},clearRejected:function(){localStorage.removeItem("rejected");qrScan.rejected=[];rejected_li_arr=[];qrScan.updateHTMLArray("rejected");
qrScan.updateCluster(rejected_li_arr);qrScan.animate._showToast("Lista de rejeitados apagada!",1100)},saveToFile:function(a,b,c){var d=document.createElement("a");a=new Blob([a],{type:c});d.href=URL.createObjectURL(a);d.download=b;d.click()},saveJSON:function(){var a=new Date,b=a.getDay(),c=a.getMonth()+1,d=a.getFullYear(),e=a.getHours(),a=a.getMinutes();qrScan.saveToFile(JSON.stringify(qrScan.data),"propespqr-"+campi+"-"+b+"-"+c+"-"+d+"-"+e+"-"+a+".json","text/json")},initScanner:function(a){scanner=
new Instascan.Scanner(a)},animate:{_snap:function(){document.querySelector("#cameraCanvas .snap").classList.remove("snap-anim");$("#cameraCanvas .snap").addClass("snap-anim").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(a){document.querySelector("#cameraCanvas .snap").classList.remove("snap-anim")})},_showToast:function(a,b){var c=document.querySelector(".mdl-js-snackbar");void 0==b&&(b=300);void 0!==toastTimeout&&clearTimeout(toastTimeout);document.querySelector(".mdl-js-snackbar").classList.remove("mdl-snackbar--active");
toastTimeout=setTimeout(function(){c.MaterialSnackbar.showSnackbar({message:a})},b)},_success:function(){document.querySelector(".error").classList.remove("snap-status-in","snap-status-out");void 0!==snapTimeout&&clearTimeout(snapTimeout);document.querySelector(".success").classList.remove("snap-status-in","snap-status-out");document.querySelector(".success").classList.add("snap-status-in");snapTimeout=setTimeout(function(){$(".success").removeClass("snap-status-in").addClass("snap-status-out").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",
function(a){document.querySelector(".success").classList.remove("snap-status-out")})},3E3)},_error:function(){document.querySelector(".success").classList.remove("snap-status-in","snap-status-out");void 0!==snapTimeout&&clearTimeout(snapTimeout);document.querySelector(".error").classList.remove("snap-status-in","snap-status-out");document.querySelector(".error").classList.add("snap-status-in");snapTimeout=setTimeout(function(){$(".error").removeClass("snap-status-in").addClass("snap-status-out").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",
function(a){document.querySelector(".error").classList.remove("snap-status-out")})},3E3)},_loading:function(a){a?qrScan.LOADING.classList.remove("transparent"):qrScan.LOADING.classList.add("transparent")},_pageLoaded:function(){document.getElementById("pageLoader").style.display="none"}},newClusterize:function(){clusterize=new Clusterize({rows:actualLiArr,tag:"ul",scrollId:actualScrollId,contentId:actualContentId,no_data_text:"Nenhum bolsista"})},updateCluster:function(a){clusterize.update(a)},clearHTML:function(a){document.getElementById(a).innerHTML=
""}},clusterize=new Clusterize({rows:saved_li_arr,tag:"ul",scrollId:"scrollAreaSaved",contentId:"contentAreaSaved",no_data_text:"Nenhum bolsista",callbacks:{clusterChanged:function(){}}});null!==localStorage.getItem("data")&&(qrScan.loadFromLS("data"),qrScan.updateHTMLArray("data"));null!==localStorage.getItem("rejected")&&(qrScan.loadFromLS("rejected"),qrScan.updateHTMLArray("rejected"));var options={},options=qrScan.initVideoObjectOptions("webcameraPreview"),cameraId=0;qrScan.initScanner(options);
qrScan.initAvaliableCameras(function(){cameraId=1});qrScan.initCamera(cameraId);qrScan.scanStart(function(a){qrScan.saveScannedData(a)});scanner.addListener("active",function(){qrScan.animate._loading(!1)});scanner.addListener("inactive",function(){qrScan.animate._loading(!0)});document.getElementById("manualSync").addEventListener("click",function(){qrScan.sync()});$(".dropdown-trigger").dropdown({constrainWidth:!1});
$(".tabs").tabs({swipeable:!0,duration:200,onShow:function(){var a=document.querySelector('a[href="#scroll-tab-1"]').classList.contains("active"),b=document.querySelector('a[href="#scroll-tab-2"]').classList.contains("active"),c=document.querySelector('a[href="#scroll-tab-3"]').classList.contains("active"),d=document.getElementById("contentAreaSaved"),e=document.getElementById("contentAreaRejected");a&&!isCameraTabActive?(console.log("Camera activated."),actualLiArr=actualContentId=actualScrollId=
void 0,isCameraTabActive=!0,setTimeout(function(){scanner.start(cameraGlobal)},1500)):!a&&isCameraTabActive&&(console.log("Camera deactivated."),isCameraTabActive=!1,scanner.stop());b?(actualScrollId="scrollAreaSaved",actualContentId="contentAreaSaved",actualLiArr=saved_li_arr,qrScan.newClusterize(),d.scrollTop=d.scrollHeight):c&&(actualScrollId="scrollAreaRejected",actualContentId="contentAreaRejected",actualLiArr=rejected_li_arr,qrScan.newClusterize(),e.scrollTop=e.scrollHeight)}});
