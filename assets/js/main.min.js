var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("WeakMap",function(a){function b(a){$jscomp.owns(a,d)||$jscomp.defineProperty(a,d,{value:{}})}function c(a){var c=Object[a];c&&(Object[a]=function(a){b(a);return c(a)})}if(function(){if(!a||!Object.seal)return!1;try{var c=Object.seal({}),b=Object.seal({}),d=new a([[c,2],[b,3]]);if(2!=d.get(c)||3!=d.get(b))return!1;d["delete"](c);d.set(b,4);return!d.has(c)&&4==d.get(b)}catch(k){return!1}}())return a;var d="$jscomp_hidden_"+Math.random().toString().substring(2);c("freeze");c("preventExtensions");
c("seal");var e=0,f=function(a){this.id_=(e+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var c;!(c=a.next()).done;)c=c.value,this.set(c[0],c[1])}};f.prototype.set=function(a,c){b(a);if(!$jscomp.owns(a,d))throw Error("WeakMap key fail: "+a);a[d][this.id_]=c;return this};f.prototype.get=function(a){return $jscomp.owns(a,d)?a[d][this.id_]:void 0};f.prototype.has=function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)};f.prototype["delete"]=
function(a){return $jscomp.owns(a,d)&&$jscomp.owns(a[d],this.id_)?delete a[d][this.id_]:!1};return f},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_MAP=!1;
$jscomp.polyfill("Map",function(a){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),b=new a($jscomp.makeIterator([[c,"s"]]));if("s"!=b.get(c)||1!=b.size||b.get({x:4})||b.set({x:4},"t")!=b||2!=b.size)return!1;var d=b.entries(),e=d.next();if(e.done||e.value[0]!=c||"s"!=e.value[1])return!1;e=d.next();return e.done||4!=e.value[0].x||"t"!=e.value[1]||!d.next().done?!1:!0}catch(l){return!1}}())return a;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var b=new WeakMap,c=function(a){this.data_={};this.head_=f();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var c;!(c=a.next()).done;)c=c.value,this.set(c[0],c[1])}};c.prototype.set=function(a,c){var b=d(this,a);b.list||(b.list=this.data_[b.id]=[]);b.entry?b.entry.value=c:(b.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:c},b.list.push(b.entry),this.head_.previous.next=b.entry,this.head_.previous=b.entry,this.size++);return this};c.prototype["delete"]=
function(a){a=d(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};c.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=f();this.size=0};c.prototype.has=function(a){return!!d(this,a).entry};c.prototype.get=function(a){return(a=d(this,a).entry)&&a.value};c.prototype.entries=function(){return e(this,function(a){return[a.key,
a.value]})};c.prototype.keys=function(){return e(this,function(a){return a.key})};c.prototype.values=function(){return e(this,function(a){return a.value})};c.prototype.forEach=function(a,c){for(var b=this.entries(),d;!(d=b.next()).done;)d=d.value,a.call(c,d[1],d[0],this)};c.prototype[Symbol.iterator]=c.prototype.entries;var d=function(a,c){var d;d=c&&typeof c;"object"==d||"function"==d?b.has(c)?d=b.get(c):(d=""+ ++g,b.set(c,d)):d="p_"+c;var e=a.data_[d];if(e&&$jscomp.owns(a.data_,d))for(var f=0;f<
e.length;f++){var h=e[f];if(c!==c&&h.key!==h.key||c===h.key)return{id:d,list:e,index:f,entry:h}}return{id:d,list:e,index:-1,entry:void 0}},e=function(a,c){var b=a.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=a.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:c(b)};b=null}return{done:!0,value:void 0}})},f=function(){var a={};return a.previous=a.next=a.head=a},g=0;return c},"es6-impl","es3");$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.polyfill("Set",function(a){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!a||!a.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),b=new a($jscomp.makeIterator([c]));if(!b.has(c)||1!=b.size||b.add(c)!=b||1!=b.size||b.add({x:4})!=b||2!=b.size)return!1;var e=b.entries(),f=e.next();if(f.done||f.value[0]!=c||f.value[1]!=c)return!1;f=e.next();return f.done||f.value[0]==c||4!=f.value[0].x||f.value[1]!=f.value[0]?!1:e.next().done}catch(g){return!1}}())return a;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var b=function(a){this.map_=new Map;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)this.add(b.value)}this.size=this.map_.size};b.prototype.add=function(a){this.map_.set(a,a);this.size=this.map_.size;return this};b.prototype["delete"]=function(a){a=this.map_["delete"](a);this.size=this.map_.size;return a};b.prototype.clear=function(){this.map_.clear();this.size=0};b.prototype.has=function(a){return this.map_.has(a)};b.prototype.entries=
function(){return this.map_.entries()};b.prototype.values=function(){return this.map_.values()};b.prototype[Symbol.iterator]=b.prototype.values;b.prototype.forEach=function(a,b){var c=this;this.map_.forEach(function(d){return a.call(b,d,d,c)})};return b},"es6-impl","es3");scanner={};
var protocol="http",host="seminariopibic.ufpa.br",x="propesp",KEY="propespti2013",logIsEnabled,snapTimeout,toastTimeout,cameraGlobal,actualLiArr,actualScrollEl,actualContentEl,isCameraTabActive=!0,saved_li_arr=[],rejected_li_arr=[],syncArr=[],qrScan={data:[],rejected:[],LOADING:document.querySelector(".loading"),sortNumber:function(a,b){return a-b},initHtmlElement:function(a){return document.getElementById(a)},initVideoObjectOptions:function(a){scanner={};return{video:qrScan.initHtmlElement(a),continuous:!0,
mirror:!1,captureImage:!1,backgroundScan:!1,refractoryPeriod:4E3,scanPeriod:5}},initAvaliableCameras:function(a){Instascan.Camera.getCameras().then(function(b){a()})},initCamera:function(a){scanner.stop();Instascan.Camera.getCameras().then(function(a){if(0<a.length){var b=a[0];$.each(a,function(a,c){if(-1!==c.name.indexOf("back"))return b=c,!1});scanner.start(b);cameraGlobal=b}else alert("Nenhuma camera encontrada.")})},scanStart:function(a){scanner.addListener("scan",function(b){a(b)})},saveScannedData:function(a){var b;
console.log("QR Code content: "+a);console.log("Analysing...");console.log("Executing pretest...");null===a.match(/(\n|\s|\{|\()/g)&&(console.log("QR Code is maybe valid. Checking encoding..."),a=CryptoJS.AES.decrypt(a,KEY),a=full_dec=a.toString(CryptoJS.enc.Utf8),(b=null!==a.match(/^\{(.*)\}/g)?!0:!1)?(console.log("QR Code is encoded! Checking authenticity..."),b=null!==a.match(/^\x7b\"\x70\x72\x6f\x70\x65\x73\x70\"\:\x7b(.*)\x7d\x7d/g)?!0:!1):(console.log("QR Code is not encoded!"),console.log("QR Code is invalid!"),
b=!1));b?(console.log("QR Code is valid!"),console.log("QR data: "+a),qrScan.animate._snap(),qrScan.animate._success(),qrScan.data.push(JSON.parse(a)),a=JSON.stringify(qrScan.data),console.log("Dados salvos em RAM: "+a),a=CryptoJS.AES.encrypt(a,KEY),console.log("Dados codificados: "+a),localStorage.setItem("data",a),qrScan.animate._showToast("Dados salvos!",1100),qrScan.updateHTMLArray("data"),qrScan.updateCluster(saved_li_arr)):(console.log("QR Code is invalid!"),qrScan.animate._snap(),qrScan.animate._error(),
null!==a.match(/^\{(.*)\}/g)?qrScan.rejected.push(JSON.parse(a)):qrScan.rejected.push(a),console.log("Dados rejeitados: "+a),a=JSON.stringify(qrScan.rejected),console.log("Dados rejeitados salvos em RAM: "+a),a=CryptoJS.AES.encrypt(a,KEY),console.log("Dados rejeitados codificados: "+a),localStorage.setItem("rejected",a),qrScan.animate._showToast("QR Code inv\u00e1lido!",1100),qrScan.updateHTMLArray("rejected"),qrScan.updateCluster(rejected_li_arr))},loadFromLS:function(a){if("data"===a||void 0===
a){var b=CryptoJS.AES.decrypt(localStorage.getItem("data"),KEY).toString(CryptoJS.enc.Utf8);qrScan.data=null===localStorage.getItem("data")?qrScan.data:JSON.parse(b)}if("rejected"===a||void 0===a)a=CryptoJS.AES.decrypt(localStorage.getItem("rejected"),KEY).toString(CryptoJS.enc.Utf8),qrScan.rejected=null===localStorage.getItem("rejected")?qrScan.rejected:JSON.parse(a)},updateHTMLArray:function(a){if("data"===a||void 0===a){saved_li_arr=[];for(var b=qrScan.data.length,c=0;c<b;c++)saved_li_arr.push('<li class="collection-item avatar" data-id="'+
qrScan.data[c][x].id+'"><i class="material-icons circle">cloud_off</i><span class="title">'+qrScan.data[c][x].nome+'</span><p class="grey-text">N\u00e3o sincronizado<br></li>')}if("rejected"===a||void 0===a)for(rejected_li_arr=[],a=qrScan.rejected.length,b=0;b<a;b++)rejected_li_arr.push('<li class="collection-item"><span class="title">'+JSON.stringify(qrScan.rejected[b])+"</span></li>")},clearRejected:function(){localStorage.removeItem("rejected");qrScan.rejected=[];rejected_li_arr=[];qrScan.updateHTMLArray("rejected");
qrScan.updateCluster(rejected_li_arr);qrScan.animate._showToast("Lista de rejeitados apagada!",1100)},saveToFile:function(a,b,c){var d=document.createElement("a");a=new Blob([a],{type:c});d.href=URL.createObjectURL(a);d.download=b;d.click()},initScanner:function(a){scanner=new Instascan.Scanner(a)},animate:{_snap:function(){document.querySelector("#cameraCanvas .snap").classList.remove("snap-anim");$("#cameraCanvas .snap").addClass("snap-anim").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",
function(a){document.querySelector("#cameraCanvas .snap").classList.remove("snap-anim")})},_showToast:function(a,b){var c=document.querySelector(".mdl-js-snackbar");void 0==b&&(b=300);void 0!==toastTimeout&&clearTimeout(toastTimeout);document.querySelector(".mdl-js-snackbar").classList.remove("mdl-snackbar--active");toastTimeout=setTimeout(function(){c.MaterialSnackbar.showSnackbar({message:a})},b)},_success:function(){document.querySelector(".error").classList.remove("snap-status-in","snap-status-out");
void 0!==snapTimeout&&clearTimeout(snapTimeout);document.querySelector(".success").classList.remove("snap-status-in","snap-status-out");document.querySelector(".success").classList.add("snap-status-in");snapTimeout=setTimeout(function(){$(".success").removeClass("snap-status-in").addClass("snap-status-out").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(a){document.querySelector(".success").classList.remove("snap-status-out")})},3E3)},_error:function(){document.querySelector(".success").classList.remove("snap-status-in",
"snap-status-out");void 0!==snapTimeout&&clearTimeout(snapTimeout);document.querySelector(".error").classList.remove("snap-status-in","snap-status-out");document.querySelector(".error").classList.add("snap-status-in");snapTimeout=setTimeout(function(){$(".error").removeClass("snap-status-in").addClass("snap-status-out").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(a){document.querySelector(".error").classList.remove("snap-status-out")})},3E3)},_loading:function(a){a?
qrScan.LOADING.classList.remove("transparent"):qrScan.LOADING.classList.add("transparent")},_syncing:function(a){a?document.getElementById("manualSync").classList.add("syncing"):document.getElementById("manualSync").classList.remove("syncing")},_changeSyncStatus:function(){for(var a=qrScan.data.length,b=0;b<a;b++){var c=document.querySelector('[data-id="'+qrScan.data[b][x].id+'"] .material-icons'),d=document.querySelector('[data-id="'+qrScan.data[b][x].id+'"] p');1===qrScan.data[b][x].synced?(c.innerHTML=
"cloud_done",c.classList.remove("red"),c.classList.add("green"),d.innerHTML="Presen\u00e7a confirmada"):2===qrScan.data[b][x].synced?(c.innerHTML="close",c.classList.remove("green"),c.classList.add("red"),d.innerHTML="Usu\u00e1rio com irregularidades<br>Toque para enviar para a PROPESP"):(c.innerHTML="cloud_off",c.classList.remove("red","green"),d.innerHTML="N\u00e3o sincronizado")}},_pageLoaded:function(){document.getElementById("pageLoader").style.display="none"}},newClusterize:function(){clusterize=
new Clusterize({rows:actualLiArr,tag:"ul",scrollId:actualScrollId,contentId:actualContentId,no_data_text:"Nenhum bolsista"})},updateCluster:function(a){clusterize.update(a)},clearHTML:function(a){document.getElementById(a).innerHTML=""},sendResponse:function(a){$.ajax({type:"POST",url:protocol+"://"+host+"/classes/access_presence_list.php",crossDomain:!0,data:{dados:JSON.stringify(a)},cache:!1,success:function(a){console.log("Sincronizado com sucesso");qrScan.onSendSuccess(a)},error:function(a,c,
d){qrScan.onSendError(a,c,d)}})},onSendSuccess:function(a){console.log(a);qrScan.animate._changeSyncStatus();qrScan.animate._syncing(!1);qrScan.animate._showToast("Sincronizado com sucesso.")},onSendError:function(a,b,c){qrScan.animate._changeSyncStatus();qrScan.animate._syncing(!1);qrScan.animate._showToast("Erro ao sincronizar.");console.error(a.responseText);console.error("Erro ao sincronizar ("+b+"): "+c)},sync:function(){qrScan.animate._syncing(!0);qrScan.animate._showToast("Sincronizando...");
$.ajax({url:protocol+"://"+host+"/classes/retrieve_scholarship_holders.php",success:function(a){var b,c,d,e=qrScan.data.length,f=a.length;console.log("\n\n");console.log(a);var g=0;for(;g<e;g++){console.log("data["+g+"]: "+qrScan.data[g][x].id);1===qrScan.data[g][x].synced?(d=g,console.log("J\u00e1 sincronizado: "+qrScan.data[g][x].id)):0!==qrScan.data[g][x].synced&&void 0!==qrScan.data[g][x].synced||console.log("N\u00e3o sincronizado: "+qrScan.data[g][x].id);var h=0;b:for(;h<f;h++)if(console.log("    result["+
h+"]: "+a[h].id),qrScan.data[g][x].id==a[h].id){console.log("    ID de "+qrScan.data[g][x].id+" encontrado na posi\u00e7\u00e3o ["+h+"]");b=!0;d=g;c=h;break b}else b=!1,d=g;!0===b?(console.log("qrScan.data["+d+"][x].synced = 1"),qrScan.data[d][x].synced=1,qrScan.data[d][x].id=a[c].id,syncArr.push(a[c].id),syncArr=[].concat($jscomp.arrayFromIterable(new Set(syncArr))),syncArr.sort(qrScan.sortNumber),b=JSON.stringify(qrScan.data),console.log("Dados atualizados: "+b),enc=CryptoJS.AES.encrypt(b,KEY),
localStorage.setItem("data",enc),console.log("IDs encontrados: "+syncArr)):(console.log("qrScan.data["+d+"][x].synced = 2"),qrScan.data[d][x].synced=2);b=void 0}qrScan.sendResponse(qrScan.data);console.log(syncArr)},error:function(a,b,c){qrScan.onSendError(a,b,c)}})}},clusterize=new Clusterize({rows:saved_li_arr,tag:"ul",scrollId:"scrollAreaSaved",contentId:"contentAreaSaved",no_data_text:"Nenhum bolsista",callbacks:{clusterChanged:function(){}}});
null!==localStorage.getItem("data")&&(qrScan.loadFromLS("data"),qrScan.updateHTMLArray("data"));null!==localStorage.getItem("rejected")&&(qrScan.loadFromLS("rejected"),qrScan.updateHTMLArray("rejected"));var options={},options=qrScan.initVideoObjectOptions("webcameraPreview"),cameraId=0;qrScan.initScanner(options);qrScan.initAvaliableCameras(function(){cameraId=1});qrScan.initCamera(cameraId);qrScan.scanStart(function(a){qrScan.saveScannedData(a)});scanner.addListener("active",function(){qrScan.animate._loading(!1)});
scanner.addListener("inactive",function(){qrScan.animate._loading(!0)});document.getElementById("manualSync").addEventListener("click",function(){qrScan.sync()});$(".dropdown-trigger").dropdown({constrainWidth:!1});
$(".tabs").tabs({swipeable:!0,duration:200,onShow:function(){var a=document.querySelector('a[href="#scroll-tab-1"]').classList.contains("active"),b=document.querySelector('a[href="#scroll-tab-2"]').classList.contains("active"),c=document.querySelector('a[href="#scroll-tab-3"]').classList.contains("active"),d=document.getElementById("contentAreaSaved"),e=document.getElementById("contentAreaRejected");a&&!isCameraTabActive?(console.log("Camera activated."),actualLiArr=actualContentId=actualScrollId=
void 0,isCameraTabActive=!0,setTimeout(function(){scanner.start(cameraGlobal)},1500)):!a&&isCameraTabActive&&(console.log("Camera deactivated."),isCameraTabActive=!1,scanner.stop());b?(actualScrollId="scrollAreaSaved",actualContentId="contentAreaSaved",actualLiArr=saved_li_arr,qrScan.newClusterize(),qrScan.animate._changeSyncStatus(),d.scrollTop=d.scrollHeight):c&&(actualScrollId="scrollAreaRejected",actualContentId="contentAreaRejected",actualLiArr=rejected_li_arr,qrScan.newClusterize(),e.scrollTop=
e.scrollHeight)}});
